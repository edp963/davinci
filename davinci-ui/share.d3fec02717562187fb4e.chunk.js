(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"162badf8105dc7af2987":function(e,t,n){"use strict";n("430efd9ee93fab5ea3aa");var a=n("ab77426700a64afb515f"),r=n.n(a),o=(n("cce4e96b47a88eedc219"),n("4634762afad890a7174e")),i=n.n(o),c=(n("aaa12c37f93504858944"),n("21677e23133eca295df8")),s=n.n(c),l=n("8af190b70a6bc55c6f1b"),u=n.n(l),d=n("0d7f0986bcd2f33d8a2a"),f=n.n(d),b=n("d7dd51e1bf6bfc2c9c3d"),p=n("a28fc3c963a1d4d1a2e5"),g=n("ab4cb61bcb2dc161defb"),m=n("811a4999285c4f950f0a"),h=n("fe25efaa8d6f45e3f5f9"),y=n("54f683fcda7806277002"),v="davinci/Share/LOAD_SHARE_DASHBOARD",O="davinci/Share/LOAD_SHARE_DASHBOARD_SUCCESS",S="davinci/Share/LOAD_SHARE_DASHBOARD_FAILURE",I="davinci/Share/SET_INDIVIDUAL_DASHBOARD",w="davinci/Share/LOAD_SHARE_WIDGET",j="davinci/Share/LOAD_SHARE_WIDGET_SUCCESS",A="davinci/Share/LOAD_SHARE_RESULTSET",L="davinci/Share/LOAD_SHARE_RESULTSET_SUCCESS",D="davinci/Share/LOAD_WIDGET_CSV",_="davinci/Share/LOAD_WIDGET_CSV_SUCCESS",E="davinci/Share/LOAD_WIDGET_CSV_FAILURE",k="davinci/Share/LOAD_SELECT_OPTIONS",C="davinci/Share/LOAD_SELECT_OPTIONS_SUCCESS",T="davinci/Share/LOAD_SELECT_OPTIONS_FAILURE",R="davinci/Share/RESIZE_ALL_DASHBOARDITEM",F="davinci/Share/DRILL_DASHBOARDITEM",x="davinci/Share/DELETE_DRILL_HISTORY",P="davinci/Share/SET_SELECT_OPTIONS",q="davinci/Share/SELECT_DASHBOARD_ITEM_CHART",H="davinci/Share/GLOBAL_CONTROL_CHANGE";function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=Object(y.fromJS)({dashboard:null,title:"",config:"{}",dashboardSelectOptions:null,widgets:null,items:null,itemsInfo:null});var z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload,r=e.get("dashboardSelectOptions"),o=e.get("itemsInfo"),i=e.get("widgets");switch(n){case O:return e.set("title",a.dashboard.name).set("dashboard",a.dashboard).set("config",a.dashboard.config).set("dashboardSelectOptions",{}).set("widgets",a.dashboard.widgets).set("items",a.dashboard.relations).set("itemsInfo",a.dashboard.relations.reduce(function(e,t){return e[t.id]={datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{}},e},{}));case I:return e.set("items",[{id:1,x:0,y:0,width:12,height:12,polling:!1,frequency:0,widgetId:a.widgetId,dataToken:a.token}]).set("itemsInfo",{1:{datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{}}});case j:return i||(i=[]),e.set("widgets",i.concat(a.widget));case q:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{renderType:a.renderType,selectedItems:a.selectedItems}))));case A:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{selectedItems:[],loading:!0,queryConditions:Object.assign({},o[a.itemId].queryConditions,{tempFilters:a.requestParams.tempFilters,linkageFilters:a.requestParams.linkageFilters,globalFilters:a.requestParams.globalFilters,variables:a.requestParams.variables,linkageVariables:a.requestParams.linkageVariables,globalVariables:a.requestParams.globalVariables,pagination:a.requestParams.pagination,nativeQuery:a.requestParams.nativeQuery})}))));case H:var c=a.controlRequestParamsByItem;return Object.entries(c).forEach(function(e){var t=V(e,2),n=t[0],a=t[1],r=a.filters,i=a.variables;o[n].queryConditions=Object.assign({},o[n].queryConditions,r&&{globalFilters:r},i&&{globalVariables:i})}),e.set("itemsInfo",o);case F:return o[a.itemId].queryConditions.drillHistory||(o[a.itemId].queryConditions.drillHistory=[]),e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{queryConditions:Object.assign({},o[a.itemId].queryConditions,{drillHistory:o[a.itemId].queryConditions.drillHistory.concat(a.drillHistory)})}))));case x:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{queryConditions:Object.assign({},o[a.itemId].queryConditions,{drillHistory:o[a.itemId].queryConditions.drillHistory.slice(0,a.index+1)})}))));case L:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{loading:!1,datasource:a.resultset||{resultList:[]},renderType:a.renderType}))));case D:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{downloadCsvLoading:!0}))));case _:case E:return e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{downloadCsvLoading:!1}))));case C:return a.itemId?e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{controlSelectOptions:Object.assign({},o[a.itemId].controlSelectOptions,U({},a.controlKey,a.values))})))):e.set("dashboardSelectOptions",Object.assign({},r,U({},a.controlKey,a.values)));case P:return a.itemId?e.set("itemsInfo",Object.assign({},o,U({},a.itemId,Object.assign({},o[a.itemId],{controlSelectOptions:Object.assign({},o[a.itemId].controlSelectOptions,U({},a.controlKey,a.options))})))):e.set("dashboardSelectOptions",Object.assign({},r,U({},a.controlKey,a.options)));case R:return e.set("itemsInfo",Object.entries(o).reduce(function(e,t){var n=V(t,2),a=n[0],r=n[1];return e[a]=Object.assign({},r,{renderType:"resize",datasource:Object.assign({},r.datasource)}),e},{}));default:return e}},W=n("74431d47afb6248fcb69"),Y=n("6c68d13fe9e3e77d8fc4");function G(e){return{type:O,payload:{dashboard:e}}}function B(e){return{type:j,payload:{widget:e}}}function M(e,t,n,a){return{type:L,payload:{renderType:e,itemId:t,requestParams:n,resultset:a}}}function J(e){return{type:_,payload:{itemId:e}}}function Q(e){return{type:E,payload:{itemId:e}}}function K(e,t,n){return{type:C,payload:{controlKey:e,values:t,itemId:n}}}var X=n("95066b9b78a83cfbe91a"),Z=n("55c69f0ea731e712b8f3"),$=n("9adba983ceae6f089ff0"),ee=n("eb331aa378875c02c40d");function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ne=regeneratorRuntime.mark(le),ae=regeneratorRuntime.mark(ue),re=regeneratorRuntime.mark(de),oe=regeneratorRuntime.mark(fe),ie=regeneratorRuntime.mark(be),ce=regeneratorRuntime.mark(pe),se=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&(n[a[r]]=e[a[r]])}return n};ee.a[ee.b].shareHost;function le(e){var t,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.payload,a.prev=1,a.next=4,Object(Y.b)(X.a,"".concat($.a.share,"/dashboard/").concat(t.token));case 4:return n=a.sent,a.next=7,Object(Y.c)(G(n.payload));case 7:a.next=15;break;case 9:return a.prev=9,a.t0=a.catch(1),a.next=13,Object(Y.c)({type:S});case 13:Object(Z.a)(a.t0),t.reject(a.t0);case 15:case"end":return a.stop()}},ne,this,[[1,9]])}function ue(e){var t,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.payload,a.prev=1,a.next=4,Object(Y.b)(X.a,"".concat($.a.share,"/widget/").concat(t.token));case 4:return n=a.sent,a.next=7,Object(Y.c)(B(n.payload));case 7:t.resolve&&t.resolve(n.payload),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(1),Object(Z.a)(a.t0),t.reject(a.t0);case 14:case"end":return a.stop()}},ae,this,[[1,10]])}function de(e){var t,n,a,r,o,i,c,s,l,u,d,f,b,p,g,m,h,y,v;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return t=e.payload,n=t.renderType,a=t.itemId,r=t.dataToken,o=t.requestParams,i=o.filters,c=o.tempFilters,s=o.linkageFilters,l=o.globalFilters,u=o.variables,d=o.linkageVariables,f=o.globalVariables,b=o.pagination,p=se(o,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables","pagination"]),m=(g=b||{pageSize:0,pageNo:0}).pageSize,h=g.pageNo,O.prev=4,O.next=7,Object(Y.b)(X.a,{method:"post",url:"".concat($.a.share,"/data/").concat(r),data:Object.assign({},p,{filters:i.concat(c).concat(s).concat(l),params:u.concat(d).concat(f),pageSize:m,pageNo:h})});case 7:return y=O.sent,v=y.payload.resultList,y.payload.resultList=v&&v.slice(0,500)||[],O.next=12,Object(Y.c)(M(n,a,o,y.payload));case 12:O.next=17;break;case 14:O.prev=14,O.t0=O.catch(4),Object(Z.a)(O.t0);case 17:case"end":return O.stop()}},re,this,[[4,14]])}function fe(e){var t,n,a,r,o,i,c,s,l,u,d,f,b;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return t=e.payload,n=t.itemId,a=t.requestParams,r=t.token,o=a.filters,i=a.tempFilters,c=a.linkageFilters,s=a.globalFilters,l=a.variables,u=a.linkageVariables,d=a.globalVariables,f=se(a,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables"]),p.prev=2,p.next=5,Object(Y.b)(X.a,{method:"post",url:"".concat($.a.share,"/csv/").concat(r),data:Object.assign({},f,{filters:o.concat(i).concat(c).concat(s),params:l.concat(u).concat(d)})});case 5:return b=p.sent,p.next=8,Object(Y.c)(J(n));case 8:location.href=b.payload,p.next=16;break;case 11:return p.prev=11,p.t0=p.catch(2),p.next=15,Object(Y.c)(Q(n));case 15:Object(Z.a)(p.t0);case 16:case"end":return p.stop()}},oe,this,[[2,11]])}function be(e){var t,n,a,r,o,i,c,s,l;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,t=e.payload,n=t.controlKey,a=t.dataToken,r=t.requestParams,o=t.itemId,i=Object.entries(r),c=i.map(function(e){var t=te(e,2),n=t[0],r=t[1],o=r.columns,i=r.filters,c=r.variables;return Object(Y.b)(X.a,{method:"post",url:"".concat($.a.share,"/data/").concat(a,"/distinctvalue/").concat(n),data:{columns:o,filters:i,params:c}})}),u.next=7,Object(Y.a)(c);case 7:return s=u.sent,l=s.reduce(function(e,t,n){var a=i[n][1].columns;return 1===a.length?e.concat(t.payload.map(function(e){return e[a[0]]})):e},[]),u.next=11,Object(Y.c)(K(n,Array.from(new Set(l)),o));case 11:u.next=18;break;case 13:return u.prev=13,u.t0=u.catch(0),u.next=17,Object(Y.c)((d=u.t0,{type:T,payload:{error:d}}));case 17:Object(Z.a)(u.t0);case 18:case"end":return u.stop()}var d},ie,this,[[0,13]])}function pe(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(W.c)(v,le),Object(W.b)(w,ue),Object(W.b)(A,de),Object(W.c)(D,fe),Object(W.b)(k,be)];case 2:case"end":return e.stop()}},ce,this)}var ge=n("6c1890243ba884c62600"),me=n("38669f46145e5bedaa8f"),he=n("cd16e7d68404f3230c38"),ye=n("86d17dd26e83afa66ef9"),ve=n("d13558d97f410e04ee44"),Oe=n("588010b67050044e2341"),Se=n("30cc03302807d9f9cf5a"),Ie=n("dde802e9900958f55da9"),we=function(e){return e.get("shareDashboard")},je=n("e54a068d600ce8162b8c"),Ae=n("545cc1d5b2c0ab4381ef"),Le=(n("c099c4fc48cd9bb84110"),n("21700e306353b2e19c0b")),De=n.n(Le),_e=n("faa1775c23cdc998dbb4"),Ee=n("6b84bc0ba52f69619b39");function ke(e){return(ke="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Te(e,t){return!t||"object"!==ke(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var xe=n("f3ae47cf584ff0a4203b"),Pe=n("788b454b5eadc7b7f231"),qe=l.createElement(f.a,{title:"Login"}),He=l.createElement(De.a,{type:"loading"}),Ve=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Te(this,Re(t).call(this,e))).changeUsername=function(e){n.setState({username:e.target.value.trim()})},n.changePassword=function(e){n.setState({password:e.target.value})},n.doLogin=function(){var e=n.props,t=e.onLogin,a=e.shareInfo,r=e.legitimateUser,o=n.state,i=o.username,c=o.password;i&&c&&t(i,c,a,function(){r()})},n.state={username:"",password:""},n}var a,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,l["PureComponent"]),a=t,(r=[{key:"render",value:function(){var e=this.props.loginLoading,t=this.state,a=t.username,r=t.password;return l.createElement("div",{className:"".concat(xe.container," ").concat(xe.share)},qe,l.createElement("img",{className:xe.logo,src:n("43a863c5e801a2996d08")}),l.createElement("div",{className:"".concat(xe.window," ").concat(Pe.window)},l.createElement(_e.a,{username:a,password:r,onChangeUsername:this.changeUsername,onChangePassword:this.changePassword,onLogin:this.doLogin}),l.createElement("button",{disabled:e,onClick:this.doLogin},e?He:"","\u767b \u5f55")))}}])&&Ce(a.prototype,r),o&&Ce(a,o),t}();var Ue=Object(b.connect)(null,function(e){return{onLogin:function(t,n,a,r){return e(Object(Ee.b)(t,n,a,r))}}})(Ve);function Ne(e){return(Ne="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ye(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ge(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Be(e,t){return!t||"object"!==Ne(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=Ie.a.loadViewsDetail,Ke=n("c7b06d3320a5509f12ff"),Xe=Object(ve.b)(ve.a),Ze=u.a.createElement("h3",null,"\u6570\u636e\u52a0\u8f7d\u4e2d\u2026\u2026"),$e=u.a.createElement("div",{id:"phantomRenderSign"}),et=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Be(this,Me(t).call(this,e))).interactCallbacks={},n.interactingLinkagers={},n.interactGlobalFilters={},n.resizeSign=0,n.loadShareContent=function(e){var t=n.props,a=t.onLoadDashboard,r=t.onLoadWidget,o=t.onSetIndividualDashboard;"dashboard"===e.type?a(e.shareInfo,function(e){403===e.response.status&&n.setState({showLogin:!0})}):r(e.shareInfo,function(t){o(t.id,e.shareInfo)},function(e){403===e.response.status&&n.setState({showLogin:!0})})},n.getQs=function(e){return e.split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{})},n.getChartData=function(e,t,a,r){n.getData(n.props.onLoadResultset,e,t,a,r)},n.downloadCsv=function(e,t,a){n.getData(function(e,t,a,r){n.props.onLoadWidgetCsv(t,r,a)},"rerender",e,t)},n.getData=function(e,t,a,r,o){var i,c,s,l,u,d,f,b,p,g=n.props,m=g.currentItemsInfo,h=g.widgets.find(function(e){return e.id===r}),y=JSON.parse(h.config),v=y.cols,O=y.rows,S=y.metrics,I=y.secondaryMetrics,w=y.filters,j=y.color,A=y.label,L=y.size,D=y.xAxis,_=y.tip,E=y.orders,k=y.cache,C=y.expired,T=m[a].queryConditions;o?(i=void 0!==o.tempFilters?o.tempFilters:T.tempFilters,c=void 0!==o.linkageFilters?o.linkageFilters:T.linkageFilters,s=void 0!==o.globalFilters?o.globalFilters:T.globalFilters,l=o.variables||T.variables,u=o.linkageVariables||T.linkageVariables,d=o.globalVariables||T.globalVariables,f=o.drillStatus||void 0,b=o.pagination||T.pagination,p=o.nativeQuery||T.nativeQuery):(i=T.tempFilters,c=T.linkageFilters,s=T.globalFilters,l=T.variables,u=T.linkageVariables,d=T.globalVariables,b=T.pagination,p=T.nativeQuery);var R=v.concat(O).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),F=S.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}});I&&I.length&&(F=F.concat(I.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),j&&(R=R.concat(j.items.map(function(e){return e.name}))),A&&(R=R.concat(A.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),F=F.concat(A.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),L&&(F=F.concat(L.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),D&&(F=F.concat(D.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),_&&(F=F.concat(_.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),e(t,a,h.dataToken,{groups:f&&f.groups?f.groups:R,aggregators:F,filters:f&&f.filter?f.filter.sqls:w.map(function(e){return e.config.sql}),tempFilters:i,linkageFilters:c,globalFilters:s,variables:l,linkageVariables:u,globalVariables:d,orders:E,cache:k,expired:C,pagination:b,nativeQuery:p})},n.onWindowResize=function(){n.resizeSign&&clearTimeout(n.resizeSign),n.resizeSign=window.setTimeout(function(){n.props.onResizeAllDashboardItem(),clearTimeout(n.resizeSign),n.resizeSign=0},500)},n.visibleFullScreen=function(e){var t=n.state.allowFullScreen;e&&n.setState({currentDataInFullScreen:e}),n.setState({allowFullScreen:!t})},n.currentWidgetInFullScreen=function(e){var t=n.props,a=t.currentItems,r=t.currentItemsInfo,o=t.widgets,i=a.find(function(t){return t.id===e}),c=o.find(function(e){return e.id===i.widgetId}),s=r[e],l=r.loading;n.setState({currentDataInFullScreen:{itemId:e,widgetId:c.id,widget:c,data:s,loading:l,onGetChartData:n.getChartData}})},n.handleLegitimateUser=function(){var e=n.state,t=e.type,a=e.shareInfo;n.setState({showLogin:!1},function(){n.loadShareContent({type:t,shareInfo:a})})},n.checkInteract=function(e){return n.props.linkages.some(function(t){return+t.trigger[0]===e})},n.doInteract=function(e,t){var a=n.props,r=a.currentItems,o=a.linkages,i=Object(me.a)(e,o);n.interactingLinkagers=Object(me.b)(e,t,i,n.interactingLinkagers),Object.keys(i).forEach(function(e){var t=r.find(function(t){return t.id===+e}),a=n.interactingLinkagers[e],o=a.filters,i=a.variables;n.getChartData("rerender",+e,t.widgetId,{linkageFilters:Object.values(o).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[]),linkageVariables:Object.values(i).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[])})}),n.setState({interactingStatus:Object.assign({},n.state.interactingStatus,We({},e,!0))})},n.turnOffInteract=function(e){var t=n.props,a=t.linkages,r=t.currentItems;Object(me.c)(e,a,n.interactingLinkagers).forEach(function(e){var t=r.find(function(t){return t.id===e}),a=n.interactingLinkagers[e],o=a.filters,i=a.variables;n.getChartData("rerender",e,t.widgetId,{linkageFilters:Object.values(o).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[]),linkageVariables:Object.values(i).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[])})}),n.setState({interactingStatus:Object.assign({},n.state.interactingStatus,We({},e,!1))},function(){var t=r.find(function(t){return t.id===e});n.getChartData("clear",e,t.widgetId)})},n.getOptions=function(e,t,a,r){t?n.props.onSetSelectOptions(e,a,r):n.props.onLoadSelectOptions(e,n.state.shareInfo,a,r)},n.globalControlChange=function(e){n.props.onGlobalControlChange(e)},n.globalControlSearch=function(e){var t=n.props,a=t.currentItems,r=t.widgets,o=t.currentItemsInfo;e.forEach(function(e){var t=a.find(function(t){return t.id===e});if(t){var i=r.find(function(e){return e.id===t.widgetId}),c=o[e].queryConditions.pagination,l=0,u=Ae.w,d=!1;if(i.type===Object(je.C)().id)try{var f=JSON.parse(i.config);if("chart"===f.mode){var b=f.chartStyles.table;l=Ae.v,u=Number(b.pageSize),d=b.withNoAggregators}}catch(e){s.a.error(e)}n.getChartData("rerender",e,t.widgetId,{pagination:Object.assign({pageSize:u},c,{pageNo:l}),nativeQuery:d})}})},n.globalFilterChange=function(e){var t=n.props,a=t.currentItems,r=t.currentItemsInfo;Object.entries(e).forEach(function(e){var t=ze(e,2),o=t[0],i=t[1],c=a.find(function(e){return e.id===+o});if(c){var s=0,l=r[o].queryConditions.pagination;l.pageNo&&(s=1);var u=i.variables,d=i.filters;n.getChartData("rerender",+o,c.widgetId,{globalVariables:u,globalFilters:d,pagination:Object.assign({},l,{pageNo:s})})}})},n.dataDrill=function(e){var t=n.props,a=t.widgets,r=t.currentItemsInfo,o=t.onDrillDashboardItem,i=e.itemId,c=e.groups,s=e.widgetId,l=e.sourceDataFilter,u=e.mode,d=e.col,f=e.row,b=a.find(function(e){return e.id===s}),p=JSON.parse(b.config),g=p.cols,m=p.rows,h=p.metrics,y=(p.filters,p.color),v=p.label,O=(p.size,p.xAxis,p.tip,p.orders,p.cache,p.expired,r[i].queryConditions.drillHistory),S=void 0,I=void 0,w=void 0,j=g.concat(m).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),A=h.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}});y&&(j=j.concat(y.items.map(function(e){return e.name}))),v&&(j=j.concat(v.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),A=A.concat(v.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(je.e)(e.name),func:e.agg}})));var L=void 0,D=[],_=[],E=[],k=p.filters.map(function(e){return e.config.sql});if(O&&0!==O.length){var C=O[O.length-1],T=void 0,R=void 0;if("chart"===u&&p.selectedChart===Oe.a.Table){var F=l.reduce(function(e,t){return void 0===e[t.key]?e[t.key]=[t.value]:e[t.key].push(t.value),e},{});for(var x in F)void 0!==F[x]&&x&&E.push("".concat(x," in (").concat(F[x].map(function(e){return"'".concat(e,"'")}).join(","),")"));if(Array.isArray(E)&&E.length>0&&(k=k.concat(E)),C&&C.col&&C.col.length){var P=l[l.length-1].key,q=C.col.reduce(function(e,t){return e.push(t),t.name===P&&e.push({name:c}),e},[]);T=c&&c.length?q:C.col}}else I=C.groups[C.groups.length-1],w=l.map(function(e){return e[I]}),S="".concat(I," in (").concat(w.map(function(e){return"'".concat(e,"'")}).join(","),")"),k=C.filter.sqls.concat(S),T=d&&d.length?(C.col||[]).concat({name:d}):C.col,R=f&&f.length?(C.row||[]).concat({name:f}):C.row;var H=C.groups.some(function(e){return e===c}),V=void 0;V=H?C.groups.filter(function(e){return e!==c}):"pivot"===u?C.groups.concat([c]):"chart"===u&&p.selectedChart===Oe.a.Table?C.groups.concat([c]):[c],L={filter:{filterSource:w,name:I,sql:S,sqls:k,visualType:"string"},col:T,row:R,type:H?"up":"down",groups:V,name:c}}else{var U=void 0;if(p){var N=p.dimetionAxis;D=p.rows&&p.rows.length?p.rows:[],_=p.cols&&p.cols.length?p.cols:[];var z=p.mode;if(z&&"pivot"===z)if(g&&0!==g.length){var W=p.cols;I=W[W.length-1].name}else{var Y=p.rows;I=Y[Y.length-1].name}else if("col"===N){var G=p.cols;I=G[G.length-1].name}else if("row"===N){var B=p.rows;I=B[B.length-1].name}else if("chart"===z&&p.selectedChart===Oe.a.Table){var M=l.reduce(function(e,t){return void 0===e[t.key]?e[t.key]=[t.value]:e[t.key].push(t.value),e},{});for(var J in M)void 0!==M[J]&&J&&E.push("".concat(J," in (").concat(M[J].map(function(e){return"'".concat(e,"'")}).join(","),")"));var Q=l[l.length-1].key,K=_.reduce(function(e,t){return e.push(t),t.name===Q&&e.push({name:c}),e},[]);U=c&&c.length?K:void 0}}w=l.map(function(e){if(e&&e[I])return e[I]}),I&&I.length&&(U=d&&d.length?_.concat([{name:d}]):void 0,S="".concat(I," in (").concat(w.map(function(e){return"'".concat(e,"'")}).join(","),")"),k.push(S)),Array.isArray(E)&&E.length>0&&(k=k.concat(E));var X=j.some(function(e){return e===c}),Z=void 0;Z=X?j.filter(function(e){return e!==c}):"pivot"===u?j.concat([c]):"chart"===u&&p.selectedChart===Oe.a.Table?j.concat([c]):[c],L={filter:{filterSource:w,name:I,sql:S,sqls:k,visualType:"string"},type:X?"up":"down",col:U,row:f&&f.length?D.concat([{name:f}]):void 0,groups:Z,name:c}}o(i,L),n.getChartData("rerender",i,s,{drillStatus:L})},n.selectDrillHistory=function(e,t,a,r){var o=n.props,i=(o.currentItemsInfo,o.onDeleteDrillHistory);e?n.getChartData("rerender",a,r,{drillStatus:e}):n.getChartData("rerender",a,r),i(a,t)},n.selectChartsItems=function(e,t,a){(0,n.props.onSelectDashboardItemChart)(e,t,a)},n.state={type:"",shareInfo:"",modalLoading:!1,interactingStatus:{},allowFullScreen:!1,currentDataInFullScreen:{},showLogin:!1,phantomRenderSign:!1,controlTokenMapping:{}},n}var n,a,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,u.a.Component),n=t,(a=[{key:"componentWillMount",value:function(){var e=this.getQs(location.href.substr(location.href.indexOf("?")+1));this.setState({type:e.type,shareInfo:e.shareInfo}),this.loadShareContent(e)}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize,!1)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.currentItems,a=e.currentItemsInfo;e.dashboard,e.widgets;a&&Object.values(a).filter(function(e){return!!e.datasource.resultList.length}).length===n.length&&setTimeout(function(){t.setState({phantomRenderSign:!0})},5e3)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize,!1)}},{key:"render",value:function(){var e,t=this,n=this.props,a=n.dashboard,o=n.title,c=n.currentItems,s=n.currentItemsInfo,l=n.widgets,d=n.dashboardSelectOptions,b=this.state,p=(b.shareInfo,b.showLogin),g=b.interactingStatus,m=b.allowFullScreen,h=b.phantomRenderSign,y=null,v=null;if(c){var O=[],S={lg:[]};c.forEach(function(e){var n=e.id,a=e.x,r=e.y,o=e.width,i=e.height,c=e.widgetId,d=e.polling,f=e.frequency,b=s[n],p=b.datasource,m=b.loading,h=b.downloadCsvLoading,y=b.renderType,v=b.queryConditions,I=b.controlSelectOptions,w=b.selectedItems,j=l.find(function(e){return e.id===c}),A={model:j.model};try{A={model:JSON.parse(j.model)}}catch(e){throw new Error(e)}var L=g[n]||!1,D=v.drillHistory;O.push(u.a.createElement("div",{key:n},u.a.createElement(he.a,{itemId:n,widget:j,widgets:l,view:A,datasource:p,loading:m,polling:d,onDrillData:t.dataDrill,onSelectDrillHistory:t.selectDrillHistory,interacting:L,drillHistory:D,frequency:f,shareInfo:j.dataToken,downloadCsvLoading:h,renderType:y,controlSelectOptions:I,queryConditions:v,onGetChartData:t.getChartData,onDownloadCsv:t.downloadCsv,onTurnOffInteract:t.turnOffInteract,onCheckTableInteract:t.checkInteract,onDoTableInteract:t.doInteract,onShowFullScreen:t.visibleFullScreen,onGetControlOptions:t.getOptions,container:"share",selectedItems:w||[],onSelectChartsItems:t.selectChartsItems}))),S.lg.push({x:a,y:r,w:o,h:i,i:"".concat(n)})}),y=u.a.createElement(Xe,{className:"layout",style:{marginTop:"-16px"},rowHeight:Ae.B,margin:[Ae.A,Ae.A],breakpoints:Ae.y,cols:Ae.z,layouts:S,measureBeforeMount:!1,useCSSTransforms:!1,isDraggable:!1,isResizable:!1},O),v=u.a.createElement(ye.a,{widgets:l,currentDashboard:{widgets:c},currentItemsInfo:s,visible:m,isVisible:this.visibleFullScreen,currentDataInFullScreen:this.state.currentDataInFullScreen,onCurrentWidgetInFullScreen:this.currentWidgetInFullScreen})}else y=u.a.createElement("div",{className:Ke.shareContentEmpty},Ze),v="";e=p?u.a.createElement(Ue,{shareInfo:this.state.shareInfo,legitimateUser:this.handleLegitimateUser}):"";var I=h&&$e;return u.a.createElement(ge.a,null,u.a.createElement(f.a,{title:o}),u.a.createElement(ge.a.Title,null,u.a.createElement(r.a,null,u.a.createElement(i.a,{span:24},u.a.createElement("h2",{className:Ke.shareTitle},o))),u.a.createElement(Se.a,{currentDashboard:a,currentItems:c,onGetOptions:this.getOptions,mapOptions:d,onChange:this.globalControlChange,onSearch:this.globalControlSearch})),y,u.a.createElement("div",{className:Ke.gridBottom}),v,e,I)}}])&&Ge(n.prototype,a),o&&Ge(n,o),t}(),tt=Object(p.b)({dashboard:Object(p.a)(we,function(e){return e.get("dashboard")}),title:Object(p.a)(we,function(e){return e.get("title")}),config:Object(p.a)(we,function(e){return e.get("config")}),widgets:Object(p.a)(we,function(e){return e.get("widgets")}),currentItems:Object(p.a)(we,function(e){return e.get("items")}),currentItemsInfo:Object(p.a)(we,function(e){return e.get("itemsInfo")}),dashboardSelectOptions:Object(p.a)(we,function(e){return e.get("dashboardSelectOptions")}),linkages:Object(p.a)(we,function(e){var t=e.get("config");if(!t)return[];var n=JSON.parse(t||{}).linkages;if(!n)return[];var a=e.get("itemsInfo");return n.filter(function(e){var t=e.linkager,n=e.trigger;return a[t[0]]&&a[n[0]]})})});var nt,at=Object(b.connect)(tt,function(e){return{onLoadViewsDetail:function(t,n){return e(Qe(t,n))},onLoadDashboard:function(t,n){return e(function(e,t){return{type:v,payload:{token:e,reject:t}}}(t,n))},onLoadWidget:function(t,n,a){return e(function(e,t,n){return{type:w,payload:{token:e,resolve:t,reject:n}}}(t,n,a))},onLoadResultset:function(t,n,a,r){return e(function(e,t,n,a){return{type:A,payload:{renderType:e,itemId:t,dataToken:n,requestParams:a}}}(t,n,a,r))},onSetIndividualDashboard:function(t,n){return e(function(e,t){return{type:I,payload:{widgetId:e,token:t}}}(t,n))},onLoadWidgetCsv:function(t,n,a){return e(function(e,t,n){return{type:D,payload:{itemId:e,requestParams:t,token:n}}}(t,n,a))},onLoadSelectOptions:function(t,n,a,r){return e(function(e,t,n,a){return{type:k,payload:{controlKey:e,dataToken:t,requestParams:n,itemId:a}}}(t,n,a,r))},onSetSelectOptions:function(t,n,a){return e(function(e,t,n){return{type:P,payload:{controlKey:e,options:t,itemId:n}}}(t,n,a))},onResizeAllDashboardItem:function(){return e({type:R})},onDrillDashboardItem:function(t,n){return e(function(e,t){return{type:F,payload:{itemId:e,drillHistory:t}}}(t,n))},onDeleteDrillHistory:function(t,n){return e(function(e,t){return{type:x,payload:{itemId:e,index:t}}}(t,n))},onSelectDashboardItemChart:function(t,n,a){return e(function(e,t,n){return{type:q,payload:{itemId:e,renderType:t,selectedItems:n}}}(t,n,a))},onGlobalControlChange:function(t){return e(function(e){return{type:H,payload:{controlRequestParamsByItem:e}}}(t))}}}),rt=Object(m.a)({key:"shareDashboard",reducer:z}),ot=Object(h.a)({key:"shareDashboard",saga:pe}),it=Object(g.compose)(rt,ot,at)(et);!function(e){e.LOAD_SHARE_DISPLAY="davinci/Share/LOAD_SHARE_DISPLAY",e.LOAD_SHARE_DISPLAY_SUCCESS="davinci/Share/LOAD_SHARE_DISPLAY_SUCCESS",e.LOAD_SHARE_DISPLAY_FAILURE="davinci/Share/LOAD_SHARE_DISPLAY_FAILURE",e.LOAD_LAYER_DATA="davinci/Share/LOAD_LAYER_DATA",e.LOAD_LAYER_DATA_SUCCESS="davinci/Share/LOAD_LAYER_DATA_SUCCESS",e.LOAD_LAYER_DATA_FAILURE="davinci/Share/LOAD_LAYER_DATA_FAILURE"}(nt||(nt={}));var ct=n("af45b63fe9fc857a79a4");function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lt=Object(y.fromJS)({title:"",display:null,slide:null,layers:[],layersInfo:{},widgets:[]});var ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lt,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload,r=e.get("layersInfo");switch(n){case nt.LOAD_SHARE_DISPLAY_SUCCESS:return e.set("title",a.display.name).set("display",a.display).set("slide",a.slide).set("layers",a.slide.relations).set("widgets",a.widgets).set("layersInfo",a.slide.relations.reduce(function(e,t){return e[t.id]=t.type===ct.a.Chart?{datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[]},interactId:"",renderType:"rerender"}:{loading:!1},e},{}));case nt.LOAD_SHARE_DISPLAY_FAILURE:return e.set("display",null).set("slide",null).set("layers",[]).set("widgets",[]).set("layersInfo",{});case nt.LOAD_LAYER_DATA:return e.set("layersInfo",Object.assign({},r,st({},a.layerId,Object.assign({},r[a.layerId],{loading:!0}))));case nt.LOAD_LAYER_DATA_SUCCESS:return e.set("layersInfo",Object.assign({},r,st({},a.layerId,Object.assign({},r[a.layerId],{loading:!1,datasource:a.data,renderType:a.renderType}))));case nt.LOAD_LAYER_DATA_FAILURE:return e.set("loadings",Object.assign({},r,st({},a.layerId,Object.assign({},r[a.layerId],{loading:!1}))));default:return e}};function dt(e,t,n){return{type:nt.LOAD_SHARE_DISPLAY_SUCCESS,payload:{display:e,slide:t,widgets:n}}}function ft(e){return{type:nt.LOAD_SHARE_DISPLAY_FAILURE,payload:{error:e}}}function bt(e,t,n){return{type:nt.LOAD_LAYER_DATA_SUCCESS,payload:{renderType:e,layerId:t,data:n}}}var pt=regeneratorRuntime.mark(yt),gt=regeneratorRuntime.mark(vt),mt=regeneratorRuntime.mark(Ot),ht=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&(n[a[r]]=e[a[r]])}return n};function yt(e){var t,n,a,r,o,i,c,l,u,d;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=e.payload,n=t.token,a=t.resolve,r=t.reject,f.prev=1,f.next=4,Object(Y.b)(X.a,"".concat($.a.share,"/display/").concat(n));case 4:if(o=f.sent,i=o.header,c=o.payload,401!==i.code){f.next=11;break}return r(i.msg),f.next=10,Object(Y.c)(ft(i.msg));case 10:return f.abrupt("return");case 11:return u=(l=c).slides,d=l.widgets,f.next=15,Object(Y.c)(dt(l,u[0],d||[]));case 15:a(l,u[0],d),f.next=25;break;case 18:return f.prev=18,f.t0=f.catch(1),s.a.destroy(),f.next=23,Object(Y.c)(ft(f.t0));case 23:s.a.error("\u83b7\u53d6 Display \u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),r(f.t0);case 25:case"end":return f.stop()}},pt,this,[[1,18]])}function vt(e){var t,n,a,r,o,i,c,s,l,u,d,f,b,p,g,m,h,y,v;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return t=e.payload,n=t.renderType,a=t.layerId,r=t.dataToken,o=t.requestParams,i=o.filters,c=o.tempFilters,s=o.linkageFilters,l=o.globalFilters,u=o.variables,d=o.linkageVariables,f=o.globalVariables,b=o.pagination,p=ht(o,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables","pagination"]),m=(g=b||{pageSize:0,pageNo:0}).pageSize,h=g.pageNo,O.prev=4,O.next=7,Object(Y.b)(X.a,{method:"post",url:"".concat($.a.share,"/data/").concat(r),data:Object.assign({},p,{filters:i.concat(c).concat(s).concat(l),params:u.concat(d).concat(f),pageSize:m,pageNo:h})});case 7:return y=O.sent,v=y.payload.resultList,y.payload.resultList=v&&v.slice(0,500)||[],O.next=12,Object(Y.c)(bt(n,a,y.payload));case 12:O.next=18;break;case 14:return O.prev=14,O.t0=O.catch(4),O.next=18,Object(Y.c)((S=O.t0,{type:nt.LOAD_LAYER_DATA_FAILURE,payload:{error:S}}));case 18:case"end":return O.stop()}var S},gt,this,[[4,14]])}function Ot(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(W.c)(nt.LOAD_SHARE_DISPLAY,yt),Object(W.b)(nt.LOAD_LAYER_DATA,vt)];case 2:case"end":return e.stop()}},mt,this)}var St=n("f10f809a0f3792f3a22d"),It=function(e){return e.get("shareDisplay")};function wt(e){return(wt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function At(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Lt(e,t){return!t||"object"!==wt(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Dt(e){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _t(e,t){return(_t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Et=n("6a7fad1b7c06479779b2"),kt=n("26317c735995b6f84276"),Ct=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Lt(this,Dt(t).call(this,e))).charts={},n.getChartData=function(e,t,a,r){var o,i,c,s,l,u,d,f,b=n.props,p=b.widgets,g=b.layersInfo,m=b.onLoadLayerData,h=p.find(function(e){return e.id===a}),y=JSON.parse(h.config),v=y.cols,O=y.rows,S=y.metrics,I=y.secondaryMetrics,w=y.filters,j=y.color,A=y.label,L=y.size,D=y.xAxis,_=y.tip,E=y.orders,k=y.cache,C=y.expired,T=g[t].queryConditions;r?(o=void 0!==r.tempFilters?r.tempFilters:T.tempFilters,i=void 0!==r.linkageFilters?r.linkageFilters:T.linkageFilters,c=void 0!==r.globalFilters?r.globalFilters:T.globalFilters,s=r.variables||T.variables,l=r.linkageVariables||T.linkageVariables,u=r.globalVariables||T.globalVariables,d=r.pagination||T.pagination,f=r.nativeQuery||T.nativeQuery):(o=T.tempFilters,i=T.linkageFilters,c=T.globalFilters,s=T.variables,l=T.linkageVariables,u=T.globalVariables,d=T.pagination,f=T.nativeQuery);var R=v.concat(O).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),F=S.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}});I&&I.length&&(F=F.concat(I.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),j&&(R=R.concat(j.items.map(function(e){return e.name}))),A&&(R=R.concat(A.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),F=F.concat(A.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),L&&(F=F.concat(L.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),D&&(F=F.concat(D.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),_&&(F=F.concat(_.items.map(function(e){return{column:Object(je.e)(e.name),func:e.agg}}))),m(e,t,h.dataToken,{groups:R,aggregators:F,filters:w.map(function(e){return e.config.sql}),tempFilters:o,linkageFilters:i,globalFilters:c,variables:s,linkageVariables:l,globalVariables:u,orders:E,cache:k,expired:C,pagination:d,nativeQuery:f})},n.getPreviewStyle=function(e){var t={};switch(e.scaleMode){case"scaleWidth":t.overflowY="auto";break;case"scaleHeight":t.overflowX="auto";break;case"noScale":t.overflow="auto"}return t},n.getSlideStyle=function(e,t){var n,a=e.width,r=e.height,o=e.scaleMode,i=e.backgroundColor,c=e.backgroundImage,s=document.body,l=s.clientWidth,u=s.clientHeight,d=jt(t,2),f=d[0],b=d[1],p=(f-1)/2,g=(b-1)/2;p+=Math.max(0,(l-f*a)/(2*a)),g+=Math.max(0,(u-b*r)/(2*r));var m="translate(".concat(100*p,"%, ").concat(100*g,"%)"),h=n={overflow:"visible",width:a,height:r,transform:"".concat(m," scale(").concat(f,", ").concat(b,")")};if("scaleWidth"===o&&screen.width<=1024&&(h=document.body.style),h.backgroundSize="cover",i){var y=i.join();h.backgroundColor="rgba(".concat(y,")")}return c&&(h.backgroundImage='url("'.concat(c,'")')),n},n.loadShareContent=function(){(0,n.props.onLoadDisplay)(n.state.shareInfo,function(){console.log("share page need login...")},function(){n.setState({showLogin:!0})})},n.handleLegitimateUser=function(){n.setState({showLogin:!1},function(){n.loadShareContent()})},n.state={scale:[1,1],showLogin:!1,shareInfo:""},n}var n,a,r;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_t(e,t)}(t,l["Component"]),n=t,(a=[{key:"componentWillMount",value:function(){var e=this,t=this.props.location.query.shareInfo;this.setState({shareInfo:t},function(){e.loadShareContent()})}},{key:"componentWillReceiveProps",value:function(e){var t=e.slide,n=jt(this.state.scale,2),a=n[0],r=n[1];if(t&&this.props.slide!==t){var o=JSON.parse(t.config).slideParams,i=o.scaleMode,c=o.width,s=o.height,l=document.body,u=l.clientHeight,d=l.clientWidth,f=1,b=1;switch(i){case"scaleHeight":b=f=u/s;break;case"scaleWidth":f=b=d/c;break;case"scaleFull":f=u/s,b=d/c}r===f&&a===b||this.setState({scale:[b,f]})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.title,a=t.widgets,r=t.display,o=t.slide,i=t.layers,c=t.layersInfo,s=this.state,u=(s.scale,s.showLogin),d=s.shareInfo,b=u?l.createElement(Ue,{shareInfo:d,legitimateUser:this.handleLegitimateUser}):null,p=null,g=null;if(r){var m=this.state.scale,h=JSON.parse(o.config).slideParams;g=this.getPreviewStyle(h);var y=this.getSlideStyle(h,m),v=Array.isArray(a)?i.map(function(t){var n=a.find(function(e){return e.id===t.widgetId}),r={model:n&&n.model},o=t.id,i=JSON.parse(t.params),s=i.polling,u=i.frequency,d=c[o],f=d.datasource,b=d.loading,p=d.interactId,g=d.renderType;return l.createElement(St.a,{key:t.id,pure:!0,itemId:o,widget:n,view:r,datasource:f,layer:t,loading:b,polling:s,frequency:u,interactId:p,renderType:g,onGetChartData:e.getChartData})}):null;p=l.createElement("div",{className:kt.board,style:y},v)}return l.createElement("div",{className:Et.container},l.createElement("div",{className:kt.preview,style:g},l.createElement(f.a,{title:n}),p,b))}}])&&At(n.prototype,a),r&&At(n,r),t}(),Tt=Object(p.b)({title:Object(p.a)(It,function(e){return e.get("title")}),display:Object(p.a)(It,function(e){return e.get("display")}),slide:Object(p.a)(It,function(e){return e.get("slide")}),layers:Object(p.a)(It,function(e){return e.get("layers")}),widgets:Object(p.a)(It,function(e){return e.get("widgets")}),layersInfo:Object(p.a)(It,function(e){return e.get("layersInfo")})});var Rt=Object(b.connect)(Tt,function(e){return{onLoadDisplay:function(t,n,a){return e(function(e,t,n){return{type:nt.LOAD_SHARE_DISPLAY,payload:{token:e,resolve:t,reject:n}}}(t,n,a))},onLoadLayerData:function(t,n,a,r){return e(function(e,t,n,a){return{type:nt.LOAD_LAYER_DATA,payload:{renderType:e,layerId:t,dataToken:n,requestParams:a}}}(t,n,a,r))}}}),Ft=Object(m.a)({key:"shareDisplay",reducer:ut}),xt=Object(h.a)({key:"shareDisplay",saga:Ot}),Pt=Object(g.compose)(Ft,xt,Rt)(Ct);n.d(t,"a",function(){return Vt});var qt=function(e){console.error("Dynamic page loading failed",e)},Ht=function(e){return function(t){e(null,t.default)}};function Vt(e){return[{path:"/share/dashboard",component:it},{path:"/share/display",component:Pt},{path:"*",name:"notfound",getComponent:function(e,t){n.e(6).then(n.bind(null,"8937ca26cad1b574ef33")).then(Ht(t)).catch(qt)}}]}},2:function(e,t,n){n("5b15df55c1316f23e9d0"),e.exports=n("baf7021f8a6fabdc859e")},"295b38b8ebc92b4cd77f":function(e,t,n){"use strict";var a=n("ab4cb61bcb2dc161defb"),r=n("54f683fcda7806277002"),o=n("3ad3c1378076e862aab0"),i=n("74431d47afb6248fcb69"),c=n("4e2e9348dad8fe460c1d"),s=n("64609e458c41f180e307"),l=Object(r.fromJS)({locationBeforeTransitions:null});function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.LOCATION_CHANGE:return e.merge({locationBeforeTransitions:t.payload});default:return e}}n.d(t,"a",function(){return f});var d=Object(i.a)();function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=[d,Object(o.routerMiddleware)(t)],i=a.compose,l=Object(a.createStore)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.combineReducers)(Object.assign({route:u,language:s.a},e))}(),Object(r.fromJS)(e),i(a.applyMiddleware.apply(void 0,n)));return l.runSaga=d.run,l.injectedReducers={},l.injectedSagas={},l}},"6b84bc0ba52f69619b39":function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o});var a=n("db3f152bc7e049b9271e");function r(e,t,n,r){return{type:a.b,payload:{username:e,password:t,shareInfo:n,resolve:r}}}function o(e){return{type:a.a,payload:{user:e}}}},baf7021f8a6fabdc859e:function(e,t,n){"use strict";n.r(t),function(e){n("8c8e4f08a118a28666b0");var t=n("8af190b70a6bc55c6f1b"),a=n("63f14ac74ce296f77f4d"),r=n("d7dd51e1bf6bfc2c9c3d"),o=n("657e23e47d6bc2372772"),i=n("3ad3c1378076e862aab0"),c=n("3e48a4ad164080264b3b"),s=n("66d806c6556aa1e94936"),l=n("be54f4964cb3d17da652"),u=n("3c6f77ec51e7bc1a2a2a"),d=n("8f1ab66ca98a22c9179d"),f=(n("1fa8f1fa59fdd9f24c28"),n("4ce54d943eb1f3decabb"),n("295b38b8ebc92b4cd77f")),b=n("ed636e9c6a0f78dd7081"),p=n("162badf8105dc7af2987"),g=(n("ed0aa665d8cc7f062de1"),n("1dad865dd74034286d56"),n("3670a75cdf40147fed09"),n("360199e61df61d70683e"),n("8a7df9b2a2fe5d99ea98"),n("c302bbd821e068aec7ca"),n("488186eb3b2e0c1c414a"),n("40f52d283acb8661d97f"),n("1a8a0d02691ba2237e1c"),n("c4f39450f01ceef3e1a4")),m=(n("9c18a49d5131280d62e2"),n("df7d0ca888dfc4ab84c0"),n("c75488ff72785c93e091"),n("9522c301b87f3097acdb"),n("c051faebbdca1b75abc0"),n("e7db2ab4d56937661155"),n("6350ba3c445cdf809f5d"),n("6d75da2315198816512d"),n("2e326f71ba041e9e5483"),n("32ed649d5a98409f05d0"),n("593fb6ed96492637817d"),n("0c83eda191a155223e4f"),n("70ed4cbab24ae23bde7d"),n("38209c7bc1e9aed95306"),n("9132142da73ea939e5d6"),n("ba53a5f89c617e663ad1"),n("8835a003a3ed67b22811"),n("8c6d270aa08c18b72e43"),n("0a240ff6093590e2060b"),n("61d2dc633a96c99ada22"),n("ed842d3aa93065270196"),n("4b78455cac8a29b25e34"),n("7e08bdc8c06aba9df8ea"),n("58a6adeccb3334926a24"),n("cf137f88cec7945b84a3"),n("d3c16768a7bfb407293b"),n("ec2bbc87777bad684f91"),n("545cc1d5b2c0ab4381ef"));g.registerTheme("default",m.o);var h=Object(f.a)({},o.d),y=document.getElementById("app"),v=Object(i.syncHistoryWithStore)(o.d,h,{selectLocationState:Object(u.b)()}),O={path:"/",component:Object(s.hot)(e)(l.a),childRoutes:Object(p.a)(h),indexRoute:{onEnter:function(e,t){t("/share")}}},S=function(e){a.render(t.createElement(r.Provider,{store:h},t.createElement(d.a,{messages:e},t.createElement(o.b,{history:v,routes:O,render:Object(o.c)(Object(c.useScroll)())}))),y)};window.Intl?S(b.b):new Promise(function(e){e(Promise.all([n.e(0),n.e(7)]).then(n.t.bind(null,"97694e21b72f8e9351c4",7)))}).then(function(){return Promise.all([n.e(0).then(n.t.bind(null,"f030ad8f70186ef5cb63",7))])}).then(function(){return S(b.b)}).catch(function(e){throw e}),window.__REACT_DEVTOOLS_GLOBAL_HOOK__&&(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.inject=function(){})}.call(this,n("044f282f6141fc605782")(e))},be54f4964cb3d17da652:function(e,t,n){"use strict";var a=n("8af190b70a6bc55c6f1b"),r=n("0d7f0986bcd2f33d8a2a"),o=n.n(r),i=n("ab4cb61bcb2dc161defb"),c=n("811a4999285c4f950f0a"),s=n("fe25efaa8d6f45e3f5f9"),l=n("db3f152bc7e049b9271e"),u=n("54f683fcda7806277002"),d=Object(u.fromJS)({logged:!1,loginUser:null});var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case l.a:return e.set("logged",!0).set("loginUser",a.user);case l.c:return e.set("logged",!1).set("loginUser",null);default:return e}},b=n("74431d47afb6248fcb69"),p=n("6c68d13fe9e3e77d8fc4"),g=n("6b84bc0ba52f69619b39"),m=n("95066b9b78a83cfbe91a"),h=n("55c69f0ea731e712b8f3"),y=n("9adba983ceae6f089ff0"),v=regeneratorRuntime.mark(S),O=regeneratorRuntime.mark(I);function S(e){var t,n,a,r,o,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.username,a=t.password,r=t.shareInfo,o=t.resolve,c.prev=1,c.next=4,Object(p.b)(m.a,{method:"post",url:"".concat(y.a.share,"/login/").concat(r),data:{username:n,password:a}});case 4:return i=c.sent,c.next=7,Object(p.c)(Object(g.a)(i.payload));case 7:o(),c.next=13;break;case 10:c.prev=10,c.t0=c.catch(1),Object(h.a)(c.t0);case 13:case"end":return c.stop()}},v,this,[[1,10]])}function I(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(b.c)(l.b,S)];case 2:case"end":return e.stop()}},O,this)}var w=Object(c.a)({key:"global",reducer:f}),j=Object(s.a)({key:"global",saga:I});t.a=Object(i.compose)(w,j)(function(e){return a.createElement("div",null,a.createElement(o.a,{titleTemplate:"%s - Davinci",defaultTitle:"Davinci Web Application",meta:[{name:"description",content:"Davinci web application built for data visualization"}]}),a.Children.toArray(e.children))})},db3f152bc7e049b9271e:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r}),n.d(t,"c",function(){return o});var a="davinci/App/LOGIN",r="davinci/App/LOGGED",o="davinci/App/LOGOUT"}},[[2,10,0,5]]]);